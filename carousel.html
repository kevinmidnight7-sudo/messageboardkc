<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Apple Glass UI Leaderboard FINAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    html, body {
      height: 100vh;
      margin: 0;
      padding: 0;
      background: transparent !important;
      font-family: 'Poppins', sans-serif;
    }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    #outer-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }
    #main-container {
      display: flex;
      flex-direction: row;
      gap: 40px;
      justify-content: center;
      align-items: stretch;
      transform: scale(0.6);
      transform-origin: center center;
      width: 1080px;
    }
    .box {
      background: rgba(255,255,255,0.97);
      border-radius: 36px;
      box-shadow: 0 8px 32px rgba(40,54,68,0.13), 0 2px 10px #bbd3fa13;
      flex: 1 1 0;
      min-width: 320px;
      max-width: 420px;
      min-height: 200px;
      height: 255px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      box-sizing: border-box;
      padding: 36px 30px 30px 30px;
      backdrop-filter: blur(8px) saturate(1.09);
      border: 1.3px solid #e3ebf6;
      overflow: visible;
    }
    .glow-title {
      font-size: 2rem;
      color: #232b36;
      font-weight: 700;
      text-align: center;
      text-shadow: 0 2.5px 16px #b9e2fa33, 0 1.5px 2px #fff, 0 0 1px #b1bfd7cc;
      margin: 0 0 28px;
      letter-spacing: 0.01em;
      line-height: 1.16;
    }
    #carousel-outer {
      width: 95%;
      max-width: 330px;
      min-height: 55px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(237,249,255,0.89);
      border-radius: 17px;
      box-shadow: 0 2.5px 10px #c7e3fa29, 0 1.5px 4px #9ec9f025;
      margin: 0 auto;
      padding: 8px;
      position: relative;
      backdrop-filter: blur(4px) saturate(1.08);
      border: 1.1px solid #c5e0fa34;
    }
    #carousel {
      width: 100%;
      min-height: 30px;
      position: relative;
    }
    .item {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      transform: translate(-50%, 5px);
      opacity: 0;
      max-width: 92%;
      font-size: 1.09rem;
      font-weight: 700;
      background-image: linear-gradient(90deg, #2ed8b6 0%, #59a6ec 90%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px #2ea0b277, 0 0 2px #fff8, 0 1px 4px #3779b155;
      white-space: nowrap;
    }
    .item.active {
      opacity: 1;
      transform: translate(-50%, 0);
    }
    .badge-title {
      font-size: 1.62rem;
      color: #f2c019;
      font-weight: 700;
      text-align: center;
      text-shadow: 0 2px 10px #ffe06633, 0 1px 2px #fff, 0 0 1px #e7e3d088;
      margin-bottom: 2px;
    }
    .badge-subtitle {
      font-style: italic;
      font-size: 1.09rem;
      color: #486196;
      text-align: center;
      margin-bottom: 23px;
    }
    /* Badge Leaderboard Carousel */
    #badge-leader-carousel {
      width: 100%;
      min-height: 68px;
      position: relative;
      overflow: visible;
      margin-bottom: 2px;
    }
    .badge-leader-item {
      position: absolute;
      width: 100%;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.55s, transform 0.6s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      min-height: 56px;
    }
    .badge-leader-item.active {
      opacity: 1;
      transform: translateY(0);
    }
    .badge-leader-row {
      display: flex;
      align-items: center;
      width: 85%;
      padding: 0 14px 0 9px;
      gap: 8px;
      border-radius: 18px;
      background: rgba(183,198,223,0.13);
      box-shadow: 0 3px 10px #8cb6e933;
      backdrop-filter: blur(6px) saturate(1.05);
      border: 1.2px solid #b5d4ef18;
    }
    .gold-bg .badge-leader-row { background: rgba(255,240,180,0.16); }
    .silver-bg .badge-leader-row { background: rgba(202,213,223,0.16); }
    .bronze-bg .badge-leader-row { background: rgba(255,227,182,0.16); }
    .blue-bg .badge-leader-row { background: rgba(183,198,223,0.13); }
    .badge-leader-crown {
      font-size: 1.13em;
      margin-right: 2px;
    }
    .badge-leader-name {
      color: #233348;
      font-weight: 700;
      font-size: 1.09rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .badge-count-pill {
      background: rgba(255,255,255,0.98);
      color: #20304a;
      padding: 7px 27px;
      border-radius: 17px;
      font-weight: 700;
      font-size: 1.27em;
      box-shadow: 0 1.5px 7px #b6dffd33;
      margin-top: 10px;
      border: 1.2px solid #e3eafc;
    }
    @media (max-width: 900px) {
      #main-container {
        transform: none;
        width: 100%;
        flex-direction: column;
        gap: 18px;
      }
      .box {
        width: 95vw;
        padding-bottom: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="outer-container">
    <div id="main-container">
      <!-- Registered Members -->
      <div id="carousel-square" class="box">
        <div class="glow-title">Registered Members</div>
        <div id="carousel-outer"><div id="carousel"></div></div>
      </div>
      <!-- Badge Leaderboard -->
      <div id="badge-carousel-square" class="box">
        <span class="badge-title">Most Badges</span>
        <span class="badge-subtitle">Top Users</span>
        <div id="badge-leader-carousel"></div>
      </div>
    </div>
  </div>
  <script>
    // Firebase setup
    const cfg = {
      apiKey: "AIzaSyBHKsULqmWPFaU7bNXDp6pBZHO4p9ZiUUo",
      authDomain: "kckillerscompany-ab1ec.firebaseapp.com",
      databaseURL: "https://kckillerscompany-ab1ec-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "kckillerscompany-ab1ec",
      storageBucket: "kckillerscompany-ab1ec.firebasedatabase.app",
      messagingSenderId: "198711213988",
      appId: "1:198711213988:web:f3cacc413ac9e80dd8cb31",
      measurementId: "G-4LKP2M3JXE"
    };
    firebase.initializeApp(cfg);
    const db = firebase.database();

    // Registered Members carousel
    const carousel = document.getElementById('carousel');
    let items = [], idx = 0;
    function showItem(i) {
      items.forEach((el,j) => el.classList.toggle('active', j===i));
    }
    db.ref('users').once('value').then(snapshot => {
      const names=[];
      snapshot.forEach(child => {
        const data=child.val();
        if(data.displayName) names.push(data.displayName);
      });
      if(names.length===0) names.push('No active members');
      carousel.innerHTML='';
      names.forEach(name => {
        const div=document.createElement('div');
        div.className='item'; div.textContent=name;
        carousel.appendChild(div);
      });
      items=carousel.querySelectorAll('.item');
      showItem(0);
      setInterval(() => { idx=(idx+1)%items.length; showItem(idx); }, 2100);
    });

    // Badge Leaderboard carousel
    const badgeCarousel=document.getElementById('badge-leader-carousel');
    let badgeLeaderItems=[], badgeIdx=0;
    const placeGradientClass=i => i===0?'gold-bg':i===1?'silver-bg':i===2?'bronze-bg':'blue-bg';
    const placeCrown=i => i===0?'👑':i===1?'🥈':i===2?'🥉':'🎖️';
    Promise.all([
      db.ref('users').once('value'),
      db.ref('badges').once('value')
    ]).then(([userSnap,badgeSnap]) => {
      const uidToName={};
      userSnap.forEach(child => {
        const v=child.val();
        uidToName[child.key]=v.displayName||v.email||child.key;
      });
      const allUids=Object.keys(uidToName);
      if(allUids.length===0) {
        badgeCarousel.innerHTML='<div class="badge-leader-item blue-bg active"><span class="badge-leader-name">No users found!</span></div>';
        return;
      }
      let badgeTotals=allUids.map(uid => {
        const badgeObj=badgeSnap.child(uid).val()||{};
        let sum=0;
        for(let k in badgeObj) sum+=parseInt(badgeObj[k])||0;
        return {displayName:uidToName[uid],badgeCount:sum};
      });
      badgeTotals.sort((a,b)=>b.badgeCount-a.badgeCount||a.displayName.localeCompare(b.displayName));
      badgeTotals.forEach((user,i) => {
        const div=document.createElement('div');
        div.className=`badge-leader-item ${placeGradientClass(i)}`;
        div.innerHTML=`<div class="badge-leader-row"><span class="badge-leader-crown">${placeCrown(i)}</span><span class="badge-leader-name" title="${user.displayName}">${user.displayName}</span></div><span class="badge-count-pill">${user.badgeCount}</span>`;
        badgeCarousel.appendChild(div);
      });
      badgeLeaderItems=badgeCarousel.querySelectorAll('.badge-leader-item');
      function showBadgeLeader(i) {
        badgeLeaderItems.forEach((el,j)=>el.classList.toggle('active',j===i));
      }
      if(badgeLeaderItems.length>0) {
        showBadgeLeader(0);
        setInterval(() => { badgeIdx=(badgeIdx+1)%badgeLeaderItems.length; showBadgeLeader(badgeIdx); }, 2400);
      }
    });
  </script>
</body>
</html>
