<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>KC Events Discord Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    html, body {
  background: transparent !important;
      margin: 0; padding: 0;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
    }
    body {
      display: flex; align-items: center; justify-content: center; min-height: 100vh;
    }
    .discord-leaderboard {
      width: 1160px; max-width: 98vw;
      border-radius: 22px;
      background: rgba(24,29,39,0.98);
      box-shadow: 0 2px 26px #0c102522, 0 2px 14px #7ab9fa22;
      padding: 36px 18px 32px 18px;
      display: flex; flex-direction: row;
      gap: 20px;
      justify-content: space-between;
    }
    .lb-col {
      flex: 1 1 0; min-width: 0;
      display: flex; flex-direction: column; align-items: stretch;
      gap: 13px;
    }
    .lb-header {
      font-weight: 700;
      font-size: 1.13em;
      color: #fff;
      letter-spacing: 0.03em;
      margin-bottom: 10px;
      display: flex; align-items: center; gap: 9px;
      text-shadow: 0 1.5px 8px #7eebfa25;
    }
    .lb-header .header-ic {
      font-size: 1.28em;
      margin-right: 5px;
      filter: drop-shadow(0 2px 7px #41fae433);
    }
    .lb-scroll-area {
      max-height: 247px;
      overflow-y: auto;
      padding-right: 5px;
      position: relative;
    }
    .lb-scroll-area::-webkit-scrollbar {
      width: 8px;
      background: transparent;
    }
    .lb-scroll-area::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #40e0ff60 0%, #2b304f88 100%);
      border-radius: 7px;
    }
    .lb-row {
      display: flex; align-items: center;
      background: linear-gradient(90deg,#232a3a 88%,#1e2633 100%);
      padding: 9px 13px 9px 9px;
      border-radius: 12px;
      margin-bottom: 0.5em;
      box-shadow: 0 1.5px 10px #333d4a09;
      min-height: 44px;
      transition: background .17s;
      position: relative;
    }
    .lb-row.top1 { background: linear-gradient(90deg,#40337a 92%,#2ea9b7 120%);}
    .lb-row.top2 { background: linear-gradient(90deg,#33497a 90%,#4e7ad1 120%);}
    .lb-row.top3 { background: linear-gradient(90deg,#275e78 90%,#39a19b 120%);}
    .lb-avatar {
      width: 34px; height: 34px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 12px;
      background: linear-gradient(135deg,#384374,#2ea9b7 70%);
      box-shadow: 0 1px 4px #9ccffd50;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 1.23em; font-weight: 700;
      text-transform: uppercase;
      user-select: none;
      border: 2px solid #212c40;
      flex-shrink: 0;
    }
    .lb-icon {
      font-size: 1.14em; margin-right: 5px;
      margin-left: 0;
    }
    .lb-user {
      color: #d0f6ff; font-weight: 600; font-size: 1.07em; flex: 1 1 0;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
      letter-spacing: 0.01em;
      display: flex; align-items: center;
    }
    .lb-count, .lb-badgecount {
      font-weight: 800; font-size: 1.03em; color: #faf0bd;
      background: #2ea9b7; padding: 3px 15px; border-radius: 12px;
      margin-left: 10px;
      box-shadow: 0 1px 4px #00ffd98f;
    }
    .lb-badgecount { background: #fde34c; color: #392f17; }
    .lb-row:last-child { margin-bottom: 0; }
    @media (max-width: 900px) {
      .discord-leaderboard { flex-direction: column; width: 99vw; padding: 24px 6px;}
      .lb-scroll-area {max-height: 168px;}
    }
  </style>
</head>
<body>
  <div class="discord-leaderboard">
    <!-- Registered Members -->
    <div class="lb-col" id="members-col">
      <div class="lb-header"><span class="header-ic">üë•</span>Members</div>
      <div class="lb-scroll-area" id="lb-members"></div>
    </div>
    <!-- Highest Streaks -->
    <div class="lb-col" id="streaks-col">
      <div class="lb-header"><span class="header-ic">üî•</span>Streaks</div>
      <div class="lb-scroll-area" id="lb-streaks"></div>
    </div>
    <!-- Most Badges -->
    <div class="lb-col" id="badges-col">
      <div class="lb-header"><span class="header-ic">üèÖ</span>Badges</div>
      <div class="lb-scroll-area" id="lb-badges"></div>
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // Firebase setup (copied from your index.html)
    const cfg = {
      apiKey: "AIzaSyBHKsULqmWPFaU7bNXDp6pBZHO4p9ZiUUo",
      authDomain: "kckillerscompany-ab1ec.firebaseapp.com",
      databaseURL: "https://kckillerscompany-ab1ec-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "kckillerscompany-ab1ec",
      storageBucket: "kckillerscompany-ab1ec.firebasestorage.app",
      messagingSenderId: "198711213988",
      appId: "1:198711213988:web:f3cacc413ac9e80dd8cb31",
      measurementId: "G-4LKP2M3JXE"
    };
    firebase.initializeApp(cfg);
    const db = firebase.database();

    // Avatar: from users/{uid}/avatar
    function getAvatarUrl(user) {
      return user.avatar || 'https://kevinmidnight7-sudo.github.io/messageboardkc/1.png';
    }

    // Members (alphabetical)
    const lbMembers = document.getElementById('lb-members');
    db.ref('users').once('value').then(snapshot => {
      let arr = [];
      snapshot.forEach(child => {
        const data = child.val();
        arr.push({
          name: data.displayName || data.email || child.key,
          avatar: getAvatarUrl(data)
        });
      });
      arr.sort((a, b) => a.name.localeCompare(b.name));
      lbMembers.innerHTML = arr.map((u, i) => `
        <div class="lb-row top${i<3?i+1:''}">
          <img class="lb-avatar" src="${u.avatar}" alt="avatar" />
          <span class="lb-user">${u.name}</span>
        </div>
      `).join('') || `<div class="lb-row">No members yet</div>`;
    });

    // Streaks (from users/{uid}/loginStreak)
    const lbStreaks = document.getElementById('lb-streaks');
    db.ref('users').once('value').then(snapshot => {
      let arr = [];
      snapshot.forEach(child => {
        const v = child.val();
        let streakNum = typeof v.loginStreak === "number" ? v.loginStreak : (parseInt(v.loginStreak)||0);
        arr.push({
          name: v.displayName || v.email || child.key,
          streak: streakNum,
          avatar: getAvatarUrl(v)
        });
      });
      arr.sort((a, b) => b.streak - a.streak || a.name.localeCompare(b.name));
      lbStreaks.innerHTML = arr.map((u, i) => `
        <div class="lb-row top${i<3?i+1:''}">
          <img class="lb-avatar" src="${u.avatar}" alt="avatar" />
          <span class="lb-user"><span class="lb-icon">üî•</span>${u.name}</span>
          <span class="lb-count">${u.streak}</span>
        </div>
      `).join('') || `<div class="lb-row">No streaks yet</div>`;
    });

    // Badges (total for each user, show avatars)
    const lbBadges = document.getElementById('lb-badges');
    Promise.all([
      db.ref('users').once('value'),
      db.ref('badges').once('value')
    ]).then(([userSnap, badgeSnap]) => {
      const users = [];
      userSnap.forEach(child => {
        const v = child.val();
        users.push({
          uid: child.key,
          name: v.displayName || v.email || child.key,
          avatar: getAvatarUrl(v)
        });
      });
      let badgeTotals = users.map(user => {
        const badgeObj = badgeSnap.child(user.uid).val() || {};
        let sum = 0;
        for (let k in badgeObj) sum += parseInt(badgeObj[k]) || 0;
        return {
          ...user,
          count: sum
        };
      });
      badgeTotals.sort((a, b) => b.count - a.count || a.name.localeCompare(b.name));
      lbBadges.innerHTML = badgeTotals.map((u, i) => `
        <div class="lb-row top${i<3?i+1:''}">
          <img class="lb-avatar" src="${u.avatar}" alt="avatar" />
          <span class="lb-user"><span class="lb-icon">üèÖ</span>${u.name}</span>
          <span class="lb-badgecount">${u.count}</span>
        </div>
      `).join('') || `<div class="lb-row">No badges yet</div>`;
    });
  </script>
</body>
</html>
